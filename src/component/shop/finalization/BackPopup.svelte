<script>
    import { formatPrice } from "$lib/formating";
    import { onMount } from "svelte";

    let { discounts, updatePage=()=>{}, updateScroll=()=>{} } = $props();
    let open = $state(false);

    export const openPopup = () => {
        updateScroll({ locked: true });
        open = true;
    }
    export const closePopup = () => {
        open = false;
        updateScroll({ locked: false });
    }
</script>

<div class={`w-full h-full fixed top-0 left-0 z-60 touch-none no-selectable ${!open && "pointer-events-none"}`}>
    <div class={`absolute bottom-0 left-0 flex flex-col w-full h-full bg-[#00000099] justify-center items-center ${open ? "opacity-100" : "opacity-0"} transition-opacity duration-200 ease-in-out z-20 no-selectable`}>
        <div class="flex flex-col w-[288px] bg-white rounded-[16px] relative">
            <button type="button" aria-label="Fechar" class="absolute top-[7px] right-[8px] p-2 z-50" onclick={closePopup}>
                <svg class="w-[13px] shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 38 38">
                    <path fill="#000" d="m0 4 4-4 15 15L34 0l4 4-15 15 15 15-4 4-15-15L4 38 .5 34 15 19 0 4Z"/>
                </svg>
            </button>
            <div class="flex flex-col w-full p-[19px] px-[24px] pb-[12px]">
                <svg class="h-[102px] mt-[8px]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 990 479">
                    <path fill="#000" fill-rule="evenodd" d="M669.155 23.25C630.02 61.682 609.87 81.279 601.959 88.6a3962.814 3962.814 0 0 0-10 9.278c-1.375 1.286-8.063 7.093-14.863 12.904-10.014 8.558-12.528 10.27-13.231 9.014-.477-.852-4.053-5.672-7.946-10.709-11.624-15.04-29.697-28.355-47.558-35.038-22.167-8.293-53.585-8.329-72.824-.083-2.609 1.119-4.932 2.034-5.161 2.034-.229 0-.417-1.406-.417-3.123 0-4.761-6.533-23.249-11.632-32.92-5.178-9.821-11.573-18.757-15.804-22.085-3.512-2.763-8.705-2.96-11.493-.436-4.64 4.199-8.952 23.224-9.081 40.064-.044 5.752-.271 6.704-1.272 5.34-.67-.913-4.081-5.744-7.58-10.737-17.667-25.208-28.776-28.517-35.325-10.521-1.683 4.624-2.246 8.87-2.578 19.418l-.424 13.5-4.853-4.703c-8.045-7.795-15.899-10.676-20.2-7.411-.958.727-2.758 3.526-4 6.218-2.055 4.456-2.258 6.379-2.258 21.396 0 11.864.524 19.31 1.866 26.5 3.478 18.642 5.197 25.678 12.67 51.85 1.704 5.967 2.956 10.987 2.781 11.156-.174.169-5.717-2.311-12.317-5.511-6.6-3.2-16.725-8.052-22.5-10.782-5.775-2.731-24.675-11.969-42-20.529-35.575-17.576-41.447-19.855-51.5-19.979-9.82-.122-15.564 3.403-17.921 10.996-2.319 7.473 6.768 20.373 26.322 37.367 4.071 3.537 8.121 7.129 9 7.982.88.852 5.312 4.604 9.849 8.336 4.538 3.733 8.25 6.979 8.25 7.214 0 .235-1.687-.29-3.75-1.165-4.598-1.952-29.366-9.659-38.25-11.902-10.298-2.6-28.039-5.513-33.5-5.501-10.184.024-16.426 5.217-15.055 12.526 1.698 9.052 19.649 23.43 48.486 38.835l11.431 6.107-12.257.768c-9.329.584-13.576 1.324-17.786 3.099-15.628 6.59-18.68 19.28-8.381 34.838 12.801 19.337 44.168 43.356 79.922 61.198 24.27 12.112 57.48 24.181 80.14 29.124 4.125.9 13.513 2.925 20.863 4.501 7.35 1.576 13.554 3.056 13.787 3.289.234.234-.002 1.495-.524 2.804-.522 1.308-2.808 8.454-5.079 15.879a7012.8 7012.8 0 0 1-6.457 21 754.58 754.58 0 0 0-4.585 15.5c-1.242 4.4-2.82 9.575-3.506 11.5-.687 1.925-2.045 7.661-3.02 12.746-3.152 16.455-1.02 18.79 20.188 22.106 36.334 5.682 73.664 8.53 81.992 6.256 6.137-1.676 9.785-6.363 11.332-14.558 3.278-17.376-2.02-23.988-23.741-29.627-4.742-1.231-8.25-2.669-8.25-3.381 0-1.083 1.679-8.755 6.465-29.542.696-3.025 1.954-8.2 2.796-11.5.842-3.3 1.811-7.238 2.154-8.75l.623-2.75h30.442c16.743 0 35.057-.502 40.698-1.116 11.705-1.273 10.28-2.055 16.433 9.017 8.023 14.437 24.492 41.688 34.629 57.298 10.435 16.069 17.193 17.883 34.386 9.231 12.901-6.492 39.007-22.809 47.874-29.92 9.291-7.453 11.488-11.169 11.495-19.444.006-7.845-2.639-13.93-7.748-17.827-2.886-2.201-4.591-2.704-9.147-2.695-5.039.01-6.691.64-16.491 6.286-7.334 4.226-11.743 6.177-13.5 5.973-2.176-.253-3.704-2.217-9.206-11.834-3.628-6.341-8.785-15.686-11.459-20.765l-4.862-9.235 3.959-3.157c6.658-5.311 14.401-13.826 18.856-20.737 7.946-12.329 10.804-19.256 15.296-37.075 2.367-9.386 2.656-12.463 2.727-29l.08-18.5 10 10c17.252 17.252 39.222 29.826 64.5 36.916 9.075 2.545 25.338 4.586 36.243 4.548 27.951-.097 51.558-9.439 71.507-28.296 14.925-14.108 26.307-32.966 28.276-46.848.554-3.907 1.263-8.125 1.577-9.375.375-1.493-.091-2.933-1.357-4.199-1.61-1.61-3.974-2.037-14.337-2.589-53.298-2.838-110.179-6.448-120.909-7.674-4.675-.534-16.15-1.418-25.5-1.964-16.606-.969-48.651-3.836-49.217-4.403-.157-.157 6.279-14.197 14.303-31.2 8.023-17.004 18.42-39.466 23.105-49.916 4.684-10.45 9.558-21.25 10.83-24 1.272-2.75 4.429-9.725 7.015-15.5 9.768-21.814 24.594-50.722 28.977-56.5 2.503-3.3 4.812-7.018 5.131-8.263.695-2.714-1.151-5.237-3.831-5.237-1.188 0-11.131 9.024-25.617 23.25Zm-273.059 6.567c-2.136 5.454-3.283 15.119-3.761 31.683-.586 20.319-.746 21.256-3.863 22.676-4.31 1.964-5.768.443-18.381-19.176-7.102-11.047-17.948-24-20.097-24-.478 0-1.694 2.138-2.702 4.75-1.485 3.847-1.833 7.601-1.833 19.75 0 13.346.261 15.687 2.364 21.228 2.63 6.932 2.336 10.559-1.001 12.345-2.971 1.591-5.606-.075-9.771-6.177-4.693-6.876-15.764-18.675-19.18-20.442-2.814-1.455-2.822-1.45-3.616 2.294-1.66 7.827-.753 32.166 1.611 43.252 4.292 20.118 9.525 40.091 15.197 58l3.009 9.5 10.694 4.952a4365.059 4365.059 0 0 1 22.693 10.609c6.6 3.111 13.082 5.998 14.403 6.414l2.404.757-.691-7.866a4342.17 4342.17 0 0 0-1.617-17.866c-2.135-23.016-.628-44.672 4.139-59.5 4.599-14.307 15.904-29.36 28.163-37.499 5.516-3.662 5.699-3.928 5.699-8.248 0-9.23-7.829-29.467-16.823-43.485-4.372-6.815-5.64-7.527-7.04-3.951Zm245.863 32.792c-15.125 15.173-33.575 33.027-41 39.673-7.425 6.647-13.725 12.367-14 12.711-.275.343-4.212 3.676-8.75 7.406-4.538 3.729-8.25 7.001-8.25 7.27 0 .269 1.843 3.926 4.095 8.127 5.982 11.159 14.383 31.626 19.581 47.704l2.586 8 3.922-8a694.522 694.522 0 0 0 7.758-16.5c3.745-8.296 7.177-15.66 16.315-35 7.216-15.271 11.249-24.173 31.713-70 5.035-11.275 10.271-22.413 11.635-24.75 1.363-2.337 2.348-4.245 2.187-4.24-.161.006-12.667 12.425-27.792 27.599Zm126.655-19.78c-1.228 1.357-1.655 3.749-1.655 9.278v7.45l-8.449 1.152c-19.622 2.676-28.801 11.742-28.81 28.453-.008 15.746 8.315 23.743 29.509 28.353l7.75 1.686v17.467c0 16.157-.131 17.43-1.75 16.972-.962-.271-3.753-.807-6.202-1.189-6.086-.95-12.067-3.651-16.283-7.352-5.652-4.963-10.765-3.817-10.765 2.414 0 6.961 13.146 14.173 29.25 16.048l5.75.669v7.329c0 6.439.27 7.516 2.223 8.884 2.937 2.058 4.37 1.964 6.777-.443 1.611-1.611 2-3.333 2-8.856v-6.855l7.25-.556c19.56-1.501 30.041-12.081 28.09-28.356-1.412-11.769-8.909-18.878-24.044-22.8-3.347-.868-7.257-1.577-8.69-1.577h-2.606V70.715l6.195.648c3.407.356 8.114 1.576 10.46 2.712 7.259 3.514 12.432 1.392 10.955-4.493-.927-3.695-8.806-7.234-19.456-8.74l-8.154-1.154v-7.344c0-6.011-.363-7.707-2-9.344-2.491-2.491-5.189-2.554-7.345-.171Zm-13.988 29.605c-6.543 1.759-9.809 4.413-12.05 9.792-2.637 6.333-1.587 13.008 2.723 17.304 3.142 3.132 12.2 7.164 18.41 8.193l3.25.539V71l-3.75.067c-2.062.038-5.925.652-8.583 1.367Zm203.833 11.731c-14.3 4.918-28.889 9.929-32.421 11.138-7.043 2.41-9.25 4.609-7.473 7.447 1.469 2.346 5.905 2.745 10.3.925 1.977-.819 15.744-5.451 30.594-10.295 14.85-4.844 27.788-9.456 28.75-10.248 2.393-1.971 2.196-4.706-.473-6.575-1.222-.856-2.459-1.506-2.75-1.444-.29.062-12.227 4.135-26.527 9.052Zm-500-5.598c-1.1.249-4.475.951-7.5 1.559-8.516 1.714-17.74 5.694-26.5 11.433-17.957 11.766-26.988 25.184-30.585 45.441-2.459 13.848-1.398 48.86 2.611 86.19 1.582 14.726 1.135 18.148-2.518 19.307-2.92.927-6.605-1.731-7.314-5.277-.321-1.603-.894-6.347-1.274-10.543-.596-6.576-.983-7.718-2.806-8.278-1.163-.357-7.064-2.899-13.114-5.648-10.178-4.625-15.247-6.993-38.5-17.984-4.675-2.21-10.509-4.887-12.965-5.949-10.415-4.505-45.25-21.095-68.492-32.62-43.392-21.517-47.437-23.208-56.238-23.516-3.846-.134-5.696.286-7.003 1.59-1.7 1.698-1.677 1.957.543 6.142 3.561 6.712 11.016 14.496 28.061 29.3 8.577 7.449 16.269 14.274 17.094 15.165.825.892 3.075 2.897 5 4.457 1.925 1.56 6.313 5.566 9.75 8.902 7.185 6.973 8.142 10.476 3.667 13.409-2.494 1.633-2.851 1.579-10.25-1.562-20.572-8.732-51.401-18.423-68.167-21.428-12.52-2.244-24-2.56-24-.66 0 3.261 18.715 17.513 35.436 26.984l6.823 3.866c12.313 6.981 22.598 11.946 31.221 15.072 7.61 2.76 10.272 4.206 11.212 6.091.992 1.99.971 2.863-.111 4.481-1.582 2.364-2.495 2.385-27.081.613-30.341-2.185-41.5.766-41.5 10.977 0 15.202 32.926 44.368 75.5 66.877 18.084 9.561 47.407 20.867 70 26.99 4.4 1.192 9.35 2.569 11 3.06 8.602 2.56 46.458 9.595 56.5 10.5 4.125.372 12.225 1.279 18 2.016 5.775.737 21.497 1.882 34.938 2.545 39.731 1.958 82.181-1.239 100.062-7.537 29.452-10.373 47.436-25.573 58.11-49.114 1.674-3.693 4.452-11.935 6.171-18.316 3.022-11.212 3.128-12.291 3.135-32.102l.008-20.5-4.809-19c-15.435-60.993-35.746-102.109-59.955-121.373-7.905-6.29-18.006-12.486-24.927-15.29-11.932-4.834-17.837-5.98-32.733-6.357-7.975-.202-15.4-.163-16.5.087Zm319.5 58.933V154l3.25-.024c14.472-.109 22.503-8.231 19.569-19.789-1.304-5.137-5.128-8.393-13.189-11.226-10.176-3.576-9.63-4.4-9.63 14.539Zm-263.25-13.42c-2.328 1.356-2.211 5.097.316 10.049 1.188 2.33 2.282 6.876 2.577 10.71.433 5.645.156 7.346-1.816 11.153-6.431 12.414-19.981 12.04-32.888-.909-3.609-3.621-8.03-9.17-9.823-12.332-3.818-6.73-7.04-8.271-10.358-4.954-1.856 1.857-1.93 2.373-.75 5.223 2.324 5.609 8.526 14.343 14.041 19.772 9.66 9.509 23.355 14.08 33.758 11.265 4.861-1.315 11.205-6.594 15.085-12.551 2.397-3.682 2.606-4.856 2.581-14.506-.025-9.438-.302-11.024-2.732-15.68-2.334-4.473-5.979-8.39-7.714-8.29-.29.017-1.315.489-2.277 1.05Zm403.256 36.908c-1.927 3.601 1.175 5.795 10.538 7.454 18.354 3.253 30.346 4.888 36.456 4.97l6.5.088.305-3.133c.364-3.751-1.37-4.572-13.482-6.379a1363.495 1363.495 0 0 1-16.323-2.565c-4.675-.768-11.714-1.688-15.643-2.043-6.717-.609-7.216-.513-8.351 1.608Zm-316.538 41.421c-1.615 2.465-1.573 2.863.995 9.333 2.973 7.494 8.566 18.113 11.881 22.561 4.744 6.366 21.564 22.614 28.156 27.198 34.145 23.745 80.382 31.093 112.104 17.814 14.997-6.278 28.509-16.454 38.436-28.946 6.277-7.898 16.504-27.424 17.515-33.437l.599-3.568-5.327-.178c-2.93-.098-8.927-.404-13.327-.68-47.137-2.957-89.333-5.39-92.5-5.332-3.245.059-49.591-3.257-51-3.649-.825-.23-9.375-.899-19-1.488s-19.603-1.326-22.172-1.637c-4.223-.512-4.835-.319-6.36 2.009Zm299.103 19.162c-3.379 3.38-3.047 3.789 11.429 14.069 5.225 3.711 14.45 10.704 20.5 15.54 11.244 8.989 14.857 10.504 17.489 7.333 2.331-2.808.211-5.955-8.199-12.174a1985.564 1985.564 0 0 1-17.79-13.355c-17.294-13.154-20.248-14.593-23.429-11.413ZM1.16 301.2c-2.045 2.044-1.332 11.992 1.714 23.901 10.532 41.187 35.947 71.067 69.914 82.199 5.568 1.825 8.987 2.188 20.671 2.193 13.108.007 14.476-.179 21.467-2.913l7.468-2.921 4.532 2.702C139.136 413.639 173.065 429 176.93 429c.945 0 2.557-.926 3.582-2.059 2.865-3.166 1.091-5.227-7.553-8.774-11.459-4.703-40.561-18.4-41.873-19.708-.205-.205 1.543-2.529 3.885-5.166 6.48-7.294 8.967-13.388 8.978-22.006.021-15.69-10.227-29.217-24.081-31.784-9.197-1.705-19.53 5.581-21.895 15.437-2.868 11.958 2.626 27.944 12.957 37.694 1.666 1.573 3.029 3.144 3.029 3.491 0 1.228-5.586 2.898-12.608 3.77-25.484 3.163-49.794-8.971-68.908-34.395-10.132-13.476-20.13-38.997-21.92-55.958-.349-3.289-1.357-6.76-2.252-7.75-1.862-2.057-5.356-2.348-7.112-.592Zm108.872 51.435c-1.623 2.063-2.073 4.071-2.072 9.25.001 8.279 3.744 16.789 10.614 24.134l4.704 5.03 2.44-2.275c7.62-7.105 10.06-21.238 5.1-29.554-3.735-6.263-8.218-9.22-13.981-9.22-3.922 0-5.088.451-6.805 2.635Zm442.927 9.075c-6.613 3.679-17.62 7.75-27.914 10.323l-9.065 2.266 1.848 3.1c1.016 1.706 7.14 12.101 13.61 23.101 6.469 11 12.779 21.575 14.023 23.5 1.244 1.925 4.61 7.215 7.48 11.756 8.713 13.785 11.087 14.606 23.592 8.156 20.252-10.445 49.886-30.166 52.407-34.877 1.502-2.807 1.239-9.71-.499-13.07-2.12-4.1-5.699-4.759-10.83-1.993-23.037 12.416-25.363 13.061-31.67 8.778-3.493-2.372-12.467-16.595-21.482-34.046-2.75-5.324-5.45-9.638-6-9.588-.55.05-3.025 1.217-5.5 2.594Zm-189.468 11.432c-.268.747-2.538 8.108-5.044 16.358l-6.987 23c-9.723 31.986-11.501 38.866-11.501 44.511 0 2.542.499 3.046 3.93 3.97 5.82 1.567 47.162 6.675 65.767 8.125 18.463 1.44 20.513 1.029 22.855-4.576.796-1.906 1.448-5.962 1.448-9.013 0-5.118-.237-5.691-3.068-7.412-2.747-1.671-10.282-4.037-22.685-7.125-6.607-1.645-7.801-4.248-6.278-13.688.679-4.21 1.918-10.16 2.753-13.223.835-3.063 3.18-12.544 5.212-21.069l3.693-15.5-4.563-.711c-2.51-.392-11.989-1.436-21.064-2.322-9.075-.886-18.183-1.852-20.24-2.147-2.629-.377-3.885-.133-4.228.822Z" clip-rule="evenodd"/>
                    <path fill="#FE5D7D" fill-rule="evenodd" d="M750.458 5.555C725.759 10.38 707.784 19.56 691.433 35.7c-15.902 15.697-25.341 32.388-31.555 55.8-2.129 8.018-2.385 11.074-2.352 28 .034 17.276.274 19.871 2.641 28.595 1.432 5.277 4.056 13.084 5.832 17.348 3.483 8.368 12.881 23.244 18.179 28.776l3.28 3.425 27.5 1.709c35.375 2.197 73.026 4.421 89.405 5.28 10.853.569 13.212.984 14.836 2.608 1.222 1.222 1.734 2.727 1.393 4.096-.296 1.189-.851 4.127-1.232 6.527-.664 4.174-.598 4.333 1.519 3.661 3.317-1.053 15.84-8.307 22.079-12.789 7.672-5.513 21.654-20.088 27.174-28.327 9.24-13.791 13.842-25.295 16.934-42.328 7.743-42.647-7.96-84.677-40.979-109.692-9.761-7.395-26.638-16.238-36.629-19.193-17.322-5.124-43.225-6.722-59-3.64Zm18.155 37.274c-1.228 1.357-1.655 3.75-1.655 9.278v7.45l-8.449 1.152c-19.622 2.676-28.801 11.742-28.81 28.453-.008 15.746 8.315 23.743 29.509 28.353l7.75 1.686v17.467c0 16.157-.131 17.43-1.75 16.972-.962-.271-3.753-.807-6.202-1.189-6.086-.95-12.067-3.651-16.283-7.352-5.652-4.963-10.765-3.817-10.765 2.414 0 6.961 13.146 14.173 29.25 16.048l5.75.669v7.329c0 6.439.27 7.516 2.223 8.884 2.937 2.058 4.37 1.964 6.777-.443 1.611-1.611 2-3.333 2-8.856v-6.855l7.25-.556c19.56-1.501 30.041-12.081 28.09-28.356-1.412-11.769-8.909-18.878-24.044-22.8-3.347-.868-7.257-1.577-8.69-1.577h-2.606V70.715l6.195.648c3.407.356 8.114 1.576 10.46 2.712 7.259 3.514 12.432 1.392 10.955-4.493-.927-3.695-8.806-7.234-19.456-8.74l-8.154-1.154v-7.344c0-6.01-.363-7.707-2-9.344-2.491-2.49-5.189-2.554-7.345-.17Zm-13.988 29.605c-6.543 1.76-9.809 4.413-12.05 9.792-2.637 6.333-1.587 13.008 2.723 17.304 3.142 3.132 12.2 7.164 18.41 8.193l3.25.539V71l-3.75.067c-2.062.038-5.925.652-8.583 1.367Zm23.333 65.066V154l3.25-.024c14.472-.109 22.503-8.231 19.569-19.789-1.304-5.137-5.128-8.393-13.189-11.226-10.176-3.576-9.63-4.4-9.63 14.539Zm-78 69.891c0 1.127 13.192 9.218 21 12.879 20.866 9.784 46.657 13.107 72.036 9.281 13.774-2.077 14.574-2.5 16.412-8.688 2.185-7.357 2.14-7.465-3.198-7.686-11.473-.474-41.191-2.209-45.75-2.67-2.75-.279-14-.955-25-1.504-11-.548-23.487-1.282-27.75-1.629-4.263-.348-7.75-.34-7.75.017Z" clip-rule="evenodd"/>
                </svg>
                <span class="w-full text-black text-[20px] text-center font-bold leading-[25px] mt-[20px]">Não perca a chance<br/>de economizar <b class="text-[#FE2C55] font-bold">R$<br/>{formatPrice(discounts.product + discounts.payment + discounts.shipping, + discounts.coupons)}</b></span>
                <button class="flex items-center justify-center w-full h-[45px] rounded-lg bg-[#FE2C55] mt-[19px]" type="button" onclick={closePopup}>
                    <span class="text-white text-[16px] font-semibold leading-none">Finalizar compra</span>
                </button>
                <button class="flex items-center justify-center w-full h-[49px] mt-[8px]" type="button" onclick={() => { closePopup(); updatePage("product"); }}>
                    <span class="text-[#595959] text-[16px] font-semibold leading-none">Não, obrigado</span>
                </button>
            </div>
        </div>
    </div>
</div>